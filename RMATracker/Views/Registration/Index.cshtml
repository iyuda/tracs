@model RMATracker.Models.RegistrationsModel
@{
    ViewBag.QueryMode = (ViewBag.QueryMode ?? false);
    //    ViewBag.Title = "Home Page";
    string is_asterik = ViewBag.QueryMode ? ": " : "*";

}


<div class="container" style="margin-top:40px;" id="container">
    <div class="row">
        @*@{bool is_rma_empty = Model.RmaBase == null; }
            @if (!is_rma_empty) { is_rma_empty = Model.RmaBase.id == null; }*@
        @if (!ViewBag.QueryMode)
        {
            <font color="red">
                Product Registration
            </font>
            <br><br>
        }


                <form id="formRegistration" action="~/Registration/SaveRegistrationData" method="post" class="wpcf7-form" enctype="multipart/form-data" novalidate="novalidate" runat="server">
                    @Html.HiddenFor(m => m.Registrations.id)
                    @Html.HiddenFor(m => m.Registrations.registration_no)
                    <div class="form-group firm-name">
                        <label class="">Firm Name of Installer: </label>
                        @{ bool is_securitas = Model.ViewType == "rma-boa" || Model.ViewType == "rma-securitas-general";}
                        @if (!ViewBag.QueryMode)
                        {
                            @Html.TextBoxFor(m => m.TechInfo.ClientName, new {
                           @style = "width:98%",
                           @placeholder = @is_securitas ? "Securitas" : "",
                           @maxlength = "50",
                           @aria_invalid = "false",
                           @class = "wpcf7-form-control wpcf7-text rma-textfield form-control" })
                        }
                        else
                        {
                            @Html.DisplayFor(m => m.TechInfo.ClientName)
                            @Html.HiddenFor(m => m.TechInfo.ClientName)
                        }
                    </div>

                    <div class="container1">
                        <div class="section1">
                            <div class="form-group tech-name">
                                <label class="">Tech Name<span class="required">@is_asterik</span></label>
                                @if (!ViewBag.QueryMode)
                                {
                                    @Html.TextBoxFor(m => m.TechInfo.TechName, new { @maxlength = "50", @aria_invalid = "false", @aria_required = "true", @required = "", @class = "wpcf7-form-control wpcf7-text wpcf7-validates-as-required form-control" })
                                }
                                else
                                {
                                    @Html.DisplayFor(m => m.TechInfo.TechName)
                                    @Html.HiddenFor(m => m.TechInfo.TechName)
                                }
                            </div>
                        </div>
                        <div class="section1">
                            <div class="form-group tech-email">
                                <label class="">Tech Email<span class="required">@is_asterik</span></label>
                                @if (!ViewBag.QueryMode)
                                {
                                    @Html.TextBoxFor(m => m.TechInfo.TechEmail, new { @maxlength = "50", @type = "email", @aria_invalid = "false", @aria_required = "true", @required = "", @class = "wpcf7-form-control wpcf7-text wpcf7-validates-as-required form-control" })
                                }
                                else
                                {
                                    @Html.DisplayFor(m => m.TechInfo.TechEmail)
                                    @Html.HiddenFor(m => m.TechInfo.TechEmail)
                                }
                            </div>
                        </div>
                        <div class="section1">
                            <div class="form-group tech-phone">
                                <label class="">Tech Phone<span class="required">@is_asterik</span></label>
                                @if (!ViewBag.QueryMode)
                                {
                                    @Html.TextBoxFor(m => m.TechInfo.TechPhone, new { @pattern = "[789][0-9]{9}", @maxlength = "15", @type = "tel", @aria_invalid = "false", @aria_required = "true", @required = "", @class = "wpcf7-form-control wpcf7-text wpcf7-validates-as-required form-control" })
                                }
                                else
                                {
                                    @Html.DisplayFor(m => m.TechInfo.TechPhone)
                                    @Html.HiddenFor(m => m.TechInfo.TechPhone)
                                }
                            </div>
                        </div>
                    </div>

                    <br><br>

                    <fieldset>
                        <legend>End User Name &amp; Address</legend>
                        <div style="border:dashed">
                            <div class="form-group bank-name" style="padding-left:10px">
                                <label class="">Bank Name: </label>
                                @*<input class="wpcf7-form-control wpcf7-text rma-textfield form-control" name="bank-name" type="text" value="" placeholder="Bank of America" aria-invalid="false">*@
                                @if (!ViewBag.QueryMode)
                                {
                                    @Html.TextBoxFor(m => m.BankInfo.BankName, new { @style = "width:98%", @aria_invalid = "false", @class = "wpcf7-form-control wpcf7-text rma-textfield form-control" })
                                }
                                else
                                {
                                    @Html.DisplayFor(m => m.BankInfo.BankName)
                                    @Html.HiddenFor(m => m.BankInfo.BankName)
                                }
                            </div><br>

                            <div class="form-group bank-street-address" style="padding-left:10px">
                                <label class="">Street Address<span class="required">@is_asterik</span></label>
                                @*<input class="wpcf7-form-control wpcf7-text wpcf7-validates-as-required rma-textfield form-control" name="bank-street-address" type="text" value="" aria-invalid="false" aria-required="true" required="">*@
                                @if (!ViewBag.QueryMode)
                                {
                                    @Html.TextBoxFor(m => m.BankInfo.BankStreetAddress, new { @style = "width:98%", @aria_invalid = "false", @aria_required = "true", @required = "", @class = "wpcf7-form-control wpcf7-text wpcf7-validates-as-required form-control" })
                                }
                                else
                                {
                                    @Html.DisplayFor(m => m.BankInfo.BankStreetAddress)
                                    @Html.HiddenFor(m => m.BankInfo.BankStreetAddress)
                                }
                            </div>

                            <div class="container1" style="padding-left:10px">
                                <div class="section1">
                                    <div class="form-group bank-city">
                                        <label class="">City<span class="required">@is_asterik</span></label>
                                        @*<input class="wpcf7-form-control wpcf7-text wpcf7-validates-as-required form-control" name="bank-city" type="text" value="" aria-invalid="false" aria-required="true" required="">*@
                                        @if (!ViewBag.QueryMode)
                                        {
                                            @Html.TextBoxFor(m => m.BankInfo.BankCity, new { @aria_invalid = "false", @aria_required = "true", @required = "", @class = "wpcf7-form-control wpcf7-text wpcf7-validates-as-required form-control" })
                                        }
                                        else
                                        {
                                            @Html.DisplayFor(m => m.BankInfo.BankCity)
                                            @Html.HiddenFor(m => m.BankInfo.BankCity)
                                        }
                                    </div>
                                </div>
                                <div class="section1">
                                    <div class="form-group bank-state">
                                        <label class="">State<span class="required">@is_asterik</span></label>
                                        @*<input class="wpcf7-form-control wpcf7-text wpcf7-validates-as-required rma-short form-control" name="bank-state" type="text" value="" aria-invalid="false" aria-required="true" required="">*@
                                        @if (!ViewBag.QueryMode)
                                        {

                                            ViewBag.DropDownList = new SelectList(Utilities.GetStates(), "Value", "Text", Model.BankInfo == null ? null : Model.BankInfo.BankState);
                                            ViewBag.DropDownTextAlign = "left";
                                            ViewBag.DropDownListID = "BankInfo_BankState";
                                            ViewBag.DropDownListName = "BankInfo.BankState";
                                            ViewBag.DropDownWidth = 300;

                                            @RenderPage("~/Views/Shared/AutoComplete.cshtml")

                                            @*@Html.DropDownListFor(m => m.BankInfo.BankState, new SelectList(Utilities.GetStates(), "Value", "Text", Model.BankInfo == null ? null : Model.BankInfo.BankState), "-- Select State --", new
                                                {
                                                    @aria_invalid = "false",
                                                    @aria_required = "true",
                                                    @required = "",
                                                    @class = "wpcf7-form-control wpcf7-select wpcf7-validates-as-required form-control",
                                                    @onchange = "GetBankStateName(this)"
                                                })*@
                                        }
                                        else
                                        {
                                            @Html.DisplayFor(m => m.BankInfo.BankState)
                                            @Html.HiddenFor(m => m.BankInfo.BankState)
                                        }
                                        @Html.HiddenFor(m => m.BankInfo._BankStateFullName)
                                        @*@Html.TextBoxFor(m => m.BankInfo.BankState, new { @aria_invalid = "false", @aria_required = "true", @required = "", @class = "wpcf7-form-control wpcf7-text wpcf7-validates-as-required form-control" })*@
                                    </div>
                                </div>
                                <div class="section1">
                                    <div class="form-group bank-zip">
                                        <label class="">Zip Code<span class="required">@is_asterik</span></label>
                                        @*<input class="wpcf7-form-control wpcf7-text wpcf7-validates-as-required form-control" name="bank-zip" type="text" value="" aria-invalid="false" aria-required="true" required="">*@
                                        @if (!ViewBag.QueryMode)
                                        {
                                            @Html.TextBoxFor(m => m.BankInfo.BankZipCode, new { @pattern = "[0-9]{3} [0-9]{2}|[0-9]{5}|[0-9]{5}-[0-9]{4}|[0-9]{5} [0-9]{4}", @maxlength = "10", @aria_invalid = "false", @aria_required = "true", @required = "", @class = "wpcf7-form-control wpcf7-text wpcf7-validates-as-required form-control" })
                                        }
                                        else
                                        {
                                            @Html.DisplayFor(m => m.BankInfo.BankZipCode)
                                            @Html.HiddenFor(m => m.BankInfo.BankZipCode)
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <br />




                    <strong>Date of Install @is_asterik</strong> <div class="form-group service-call-date">
                        @*<input class="wpcf7-form-control wpcf7-date wpcf7-validates-as-required wpcf7-validates-as-date rma-calendar form-control" name="service-call-date" type="date" value="" min="" max="" step="" aria-invalid="false" aria-required="true" required="">*@
                        @{
                            var InstallDate = (Model.Registrations?.date_installed == null ? "" : DateTime.Parse(Model.Registrations.date_installed).ToString("yyyy-MM-dd"));
                        }
                        @if (!ViewBag.QueryMode)
                        {
                            @Html.TextBoxFor(m => m.Registrations.date_installed, new { @Value = @InstallDate, @type = "date", @min = "", @max = "", @step = "", @aria_invalid = "false", @aria_required = "true", @required = "", @class = "wpcf7-form-control wpcf7-date wpcf7-validates-as-date form-control" })
                        }
                        else
                        {
                            @Html.LabelFor(m => m.Registrations.date_installed, @InstallDate, new { @style = "font-weight: normal;" })
                            @Html.HiddenFor(m => m.Registrations.date_installed, @InstallDate)
                        }
                    </div> <br>


                    <fieldset>
                        <legend>Part Number and Serial Number Installed</legend>
                        @{
                                var PartTypes = new List<DataLayer.PartType>() { new DataLayer.PartType() };// RMATracker.Models.RMATrackerViewModel.getPartTypes();
                        }
                        @*@foreach (DataLayer.RegistrationParts part in Model.RegistrationParts.Where(p=> (p.part_types_id ?? "") !=""))*@
                        @Html.HiddenFor(m => m.CurrentPartIndex, new { @id = "CurrentPartIndex" })
                        @for (int i = 0; i < (Model.RegistrationParts != null ? Model.RegistrationParts.Count : 0); i++)
                        {
                            @Html.HiddenFor(m => m.RegistrationParts[i].id)
                            if (ViewBag.QueryMode && (Model.RegistrationParts[i].part_types_id ?? "") == "")
                            {
                                @Html.HiddenFor(m => m.RegistrationParts[i].part_types_id)
                                continue;
                            }
                            <div class="container1" style="border:solid">
                                <div class="section1" style="padding-left: 10px">
                                    @{
                                        if (!ViewBag.QueryMode)
                                        {
                                            if (i == 0)
                                            {
                                                @:<strong>Part Number @(i + 1):*</strong>
                                                @:<div class="form-group part-menu">
                                                    //ViewBag
                                                    @Html.DropDownListFor(m => m.RegistrationParts[i]._PartNo, new SelectList(PartTypes, "PartNumber", "PartDescription", Model.RegistrationParts[i]._PartNo), "-- Select Part --", new
                                               {
                                                   @aria_invalid = "false",
                                                   @aria_required = "true",
                                                   @required = "",
                                                   @class = "wpcf7-form-control wpcf7-select wpcf7-validates-as-required form-control",
                                                   @onchange = "GetPartID(this)"
                                               })
                                                }
                                                else
                                                {
                                                    @:<strong>Part Number @(i + 1):</strong>
                                                    @:<div class="form-group part-menu">
                                                        @Html.DropDownListFor(m => m.RegistrationParts[i]._PartNo, new SelectList(PartTypes, "PartNumber", "PartDescription", Model.RegistrationParts[i]._PartNo), "-- Select Part --", new
                                                   {
                                                       @aria_invalid = "false",
                                                       @class = "wpcf7-form-control wpcf7-select form-control",
                                                       @onchange = "GetPartID(this)"
                                                   })
                                                    }
                                                    @Html.DropDownListFor(m => m.RegistrationParts[i]._PartDescription, new SelectList(PartTypes, "PartDescription", "PartDescription", Model.RegistrationParts[i]._PartDescription), "--", new
                                                    {
                                                        @style = "display:none"
                                                    })
                                                    @Html.DropDownListFor(m => m.RegistrationParts[i].part_types_id, new SelectList(PartTypes, "id", "id", Model.RegistrationParts[i].part_types_id), "--", new
                                                    {
                                                        @style = "display:none"
                                                    })
                                                @:</div>
                                            }
                                            else
                                            {
                                                @:<strong>Part @(i + 1):</strong>
                                                @Html.DisplayFor(m => m.RegistrationParts[i]._PartDescription)
                                                @Html.HiddenFor(m => m.RegistrationParts[i]._PartDescription)
                                            }
                                    }

                                </div>

                                <div class="section1">
                                    @{
                                        if (!ViewBag.QueryMode)
                                        {
                                            if (i == 0)
                                            {
                                                @:<strong>Serial Number @(i + 1):* </strong>
                                                @:<div class="form-group serial-number">
                                                    @Html.TextBoxFor(m => m.RegistrationParts[i].serial_no, new { @maxlength = "6", @aria_invalid = "false", @aria_required = "true", @required = "", @class = "wpcf7-form-control wpcf7-validates-as-required form-control" })
                                                }
                                                else
                                                {
                                                    @:<strong>Serial Number @(i + 1): </strong>
                                                    @:<div class="form-group serial-number">
                                                        @Html.TextBoxFor(m => m.RegistrationParts[i].serial_no, new { @maxlength = "6", @aria_invalid = "false", @class = "wpcf7-form-control form-control" })
                                                    }
                                                @:</div>
                                            }
                                            else
                                            {
                                                @:<strong>Serial Number @(i + 1): </strong>
                                                @Html.DisplayFor(m => m.RegistrationParts[i].serial_no)
                                                @Html.HiddenFor(m => m.RegistrationParts[i].serial_no)
                                            }
                                    }
                                </div>
                                <div class="section1">
                                    @{
                                        if (!ViewBag.QueryMode)
                                        {
                                            if (i == 0)
                                            {
                                                @:<strong>Description @(i + 1):* </strong>
                                                @:<div class="form-group description-1">
                                                    @Html.TextBoxFor(m => m.RegistrationParts[i].image_description, new { @maxlength = "100", @aria_invalid = "false", @aria_required = "true", @required = "", @class = "wpcf7-form-control wpcf7-validates-as-required form-control" })
                                                }
                                                else
                                                {
                                                    @:<strong>Description @(i + 1): </strong>
                                                    @:<div class="form-group description-1">
                                                        @Html.TextBoxFor(m => m.RegistrationParts[i].image_description, new { @maxlength = "100", @aria_invalid = "false", @class = "wpcf7-form-control form-control" })
                                                    }
                                                @:</div>
                                            }
                                            else
                                            {
                                                @:<strong>Description @(i + 1): </strong>
                                                @Html.DisplayFor(m => m.RegistrationParts[i].image_description)
                                                @Html.HiddenFor(m => m.RegistrationParts[i].image_description)
                                            }
                                    }
                                </div>
                                @{
                                    int index = i;
                                    if (!ViewBag.QueryMode)
                                    {
                                        <div class="section1" style="padding-left: 10px">
                                            <div class="form-group upload-file-1">
                                                @*<input accept="image/*" aria-required="true" required="" aria-invalid="false" class="wpcf7-form-control wpcf7-slim wpcf7-validates-as-required" id="upload-file-0" name="upload-file-0" type="file">*@

                                                @*<span class="slim" data-status-file-size="File is too big, maximum file size: $0 MB." data-status-file-type="Invalid file type, expects: $0." data-status-image-too-small="Image is too small, minimum size is: $0 pixels." data-max-file-size="9" data-post="output" data-filter-sharpen="15" data-size="640,480" data-download="true">*@
                                                @{
                                                    if (i == 0)
                                                    {
                                                        @*<input accept="image/*" aria-required="true" required="" aria-invalid="false" class="wpcf7-form-control wpcf7-slim wpcf7-validates-as-required" id="upload-file-@index" name="upload-file-@index" type="file">*@

                                                        @Html.TextBox("upload-file-" + @index.ToString(), null, new
                                                   {
                                                       @index = @index.ToString(),
                                                       @type = "file",
                                                       @accept = "image/*",
                                                       @aria_invalid = "false",
                                                       @aria_required = "true",
                                                       @required = "",
                                                       @class = "wpcf7-form-control wpcf7-slim wpcf7-validates-as-required",
                                                       @onchange = "LoadImageOnForm(this)"
                                                   })

                                                        @*@Html.Image("image-" + @index.ToString(), "", "100", "100");*@
                                                        @*<img id="blah" src="#" alt="your image" />*@
                                                        @*@Html.TextBox("upload-file-"+@index.ToString(), null, new
                {
                    @type = "file",
                    @accept = "image/*",
                    @aria_invalid = "false",
                    @aria_required = "true",
                    @required = "",
                    @class = "wpcf7-form-control wpcf7-slim wpcf7-validates-as-required",
                    @onchange = "LoadFileInfo(this)"
                    })*@
                                                    }
                                                    else
                                                    {
                                                        @*<input accept="image/*" aria-invalid="false" class="wpcf7-form-control wpcf7-slim" id="upload-file-@index" name="upload-file-@index" type="file">*@
                                                        @Html.TextBox("upload-file-" + @index.ToString(), null, new
                                                   {
                                                       @index = @index.ToString(),
                                                       @type = "file",
                                                       @accept = "image/*",
                                                       @aria_invalid = "false",
                                                       @class = "wpcf7-form-control wpcf7-slim",
                                                       @onchange = "LoadImageOnForm(this)"
                                                   })
                                                    }
                                                    @Html.HiddenFor(m => m.RegistrationParts[i].image_location, new { @index = @index.ToString(), })
                                                }
                                                @*</span>*@
                                            </div>
                                        </div>
                                    }
                                    var style = (ViewBag.QueryMode) ? "style='padding-left:10px'" : "";
                                    <div class="section1" style="padding-left: 10px">
                                        @{
                                            var image_location = String.IsNullOrEmpty(Model.RegistrationParts[i].image_location) ? "" : Model.RegistrationParts[i].image_location;
                                            var absolutePath = Server.MapPath(image_location);
                                            if (!File.Exists(absolutePath)) { image_location = ".." + image_location; }
                                            if (String.IsNullOrEmpty(@image_location))
                                            {
                                                <img alt="Image Not Available" id="image-@index" style="width: auto;height: auto;" />
                                            }
                                            else
                                            {
                                                <img alt="Image Not Available" src="@image_location" id="image-@index" style="width: auto;height:100px;" />
                                            }
                                        }
                                    </div>

                                }
                            </div>
                            <br>
                        }

                </fieldset>



                <span class="wpcf7-form-control-wrap cf7-counter"><input type="hidden" name="cf7-counter" value="225" size="40" class="wpcf7-form-control wpcf7dtx-dynamictext wpcf7-dynamichidden" aria-invalid="false"></span>



                <div class="form-group">
                    <div>
                        <input class="wpcf7-form-control wpcf7-submit btn btn-primary" type="submit" value="Send" id="btnSend">
                    </div>
                </div><div class="wpcf7-response-output wpcf7-display-none alert"></div>
                </form>

<script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/jquery.validate.min.js"></script>
<script src="https://cdn.jsdelivr.net/jquery.validation/1.16.0/additional-methods.min.js"></script>
<script type="text/javascript">

    
        //$("#formRegistration").validate({});
        $("input[name$='serial_no']").each(function () {
            $(this).rules('add', {
                maxlength: 6
            });
        });
        $("input[name$='ZipCode']").each(function () {
            $(this).rules('add', {
                number: true
            });
        });



</script>

@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/bootstrap")
<script src="@Url.Content("~/Scripts/tracs-common.js")" type="text/javascript"></script>

function GetPartID(e) {

        var type_id = e.id.replace("_PartNo", "part_types_id");
        var description_id = e.id.replace("_PartNo", "_PartDescription");
        $("#" + type_id).prop('selectedIndex', $("#" + e.id + "  option:selected").index());
        $("#" + description_id).prop('selectedIndex', $("#" + e.id + "  option:selected").index());
    }
</div>
</div>
